<h1>WarCan - A CanCan-like gem</h1>

<h2>Description</h2>

<p>WarCan is an attempt to bring CanCan-like abilities to Warden and
Sinatra. It's also one of those &quot;I want to learn this, so I'll create
this&quot; kind of project. I had a need for something like this in one of my
side projects, so here it is.</p>

<h2>Usage</h2>

<h3>Create an Ability class:</h3>

<pre><code>require 'warcan'
class Ability
  include WarCan::Ability

  def initialize(user)
    @user = user

    if user[:is_admin]
      # Define as a method call to &quot;can&quot;. 
      can :manage, SecretClass, :active=&gt;true, :user_id=&gt;user[:id]
      can :manage, SecretClass2, :foo=&gt;&quot;bar&quot;, :user_id=&gt;user[:id]

      # Or define as a block
      can :view, SecretClass do |the_class|
        the_class.active == true &amp;&amp; the_class.user_id == user[:id]
        &amp;&amp; user.is_admin 
      end
    end
  end
end
</code></pre>

<h3>Define your model(s) as normal:</h3>

<p>In this case, it's a DataMapper object</p>

<pre><code>class SecretClass
  include DataMapper::Resource
  property :id, Serial
  property :active, Boolean, :default=&gt;false

  # This defines the user_id property for us
  # using DataMappers associations.
  belongs_to :user 

  # ... boring code omitted ...
end
</code></pre>

<h3>Define your user, as normal:</h3>

<pre><code>class User
  attr_accessor :id, :is_admin

  # ... code omitted ...
end
</code></pre>

<h3>Use the ability class in your app:</h3>

<pre><code>require 'my_ability'

class MySinatraApp &lt; Sinatra::Base
  get '/secret/:id' do
    secret_class = SecretClass.get(params[:id])

    # Right now, you have to create the ability object for each
    # request. This will change soon, as I make it a Sinatra Helper.
    # 
    # But, for now, use the syntax below and pass in the warden
    # env['user'] object, which is the current user (or it's nil if
    # the current user is not logged in/authenticated.

    ability = Ability.new(env['user'])  

    # The following will resolve to 'true' if the following criteria
    # are true (they were defined in the Ability class above):
    # - secret_class.active is true 
    # - The current user's id matches secret_class.user_id

    ability.can?(:view,secret_class) 
  end
end
</code></pre>
